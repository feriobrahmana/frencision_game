<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Long Friendship — Narrative Edition</title>
  <link rel="stylesheet" href="src/styles.css" />
</head>
<body>

  <!-- LOBBY SCREEN -->
  <section id="viewLobby" class="view-lobby">
    <div class="lobby-card">
      <header class="lobby-header">
        <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
           <h1 style="margin: 0;">Conquer Your Social Network</h1>
           <button id="btnLobbyTheme" class="btn-icon" title="Toggle Theme" style="background: var(--bg-surface); padding: 4px 8px; border-radius: var(--radius-sm); font-size: 16px;">☾</button>
        </div>
        <p>
          Make the best out of your life by socializing.<br/>
          Watch the network grow and find your place in it.
        </p>
      </header>

      <div class="lobby-intro" style="margin-bottom: 24px; font-size: 13px; color: var(--text-dim); line-height: 1.6; border-bottom: 1px solid var(--bg-surface); padding-bottom: 20px;">
        <strong>Motivation:</strong><br/>
        You are just one node in a vast, living network. Your goal is simple: survive.
        <br/><br/>
        By connecting with the right people, you lift yourself up. By ignoring the wrong ones, you stay safe.
        The world will shift, shocks will ripple, and purges will come. Can you make it to the end?
      </div>

      <form id="configForm" class="config-grid" autocomplete="off">
        <div class="config-group">
          <label title="Maximum number of new nodes entering the network each day. Higher means more chaos and opportunity.">
            <span>Newcomers / Day</span>
            <input type="number" name="zMax" min="0" max="10" value="5" />
            <small style="font-size: 10px; color: var(--text-dim); text-transform: none; display: block; margin-top: 4px;">Chaos Factor</small>
          </label>
          <label title="How many existing nodes each newcomer connects to instantly.">
            <span>Initial Connections</span>
            <input type="number" name="edgesPerNode" min="0" max="5" value="2" />
            <small style="font-size: 10px; color: var(--text-dim); text-transform: none; display: block; margin-top: 4px;">Network Density</small>
          </label>
        </div>
        <div class="config-group">
          <label title="How often you can spend budget to invite a new friend.">
            <span>Invitation Frequency</span>
            <input type="number" name="pickPeriod" min="1" max="20" value="7" />
            <small style="font-size: 10px; color: var(--text-dim); text-transform: none; display: block; margin-top: 4px;">Days between picks</small>
          </label>
          <label title="How often random events (good or bad) ripple through the network.">
            <span>Volatility</span>
            <input type="number" name="shockPeriod" min="2" max="30" value="3" />
            <small style="font-size: 10px; color: var(--text-dim); text-transform: none; display: block; margin-top: 4px;">Days between shocks</small>
          </label>
        </div>
        <div class="config-group">
          <label title="The Judgment Day. Nodes below the threshold are removed.">
            <span>Purge Frequency</span>
            <input type="number" name="purgePeriod" min="2" max="30" value="10" />
            <small style="font-size: 10px; color: var(--text-dim); text-transform: none; display: block; margin-top: 4px;">Days between purges</small>
          </label>
          <label title="Total number of connections you can initiate in a lifetime.">
            <span>Social Battery</span>
            <input type="number" name="budgetMax" min="0" max="50" value="10" />
            <small style="font-size: 10px; color: var(--text-dim); text-transform: none; display: block; margin-top: 4px;">Max Invites</small>
          </label>
        </div>
        <div class="form-actions">
          <button type="button" id="btnStart" class="btn btn-xl btn-primary">Initialize Network</button>
        </div>
      </form>
    </div>
  </section>

  <!-- GAME OVER SCREEN -->
  <section id="viewGameOver" class="view-lobby hidden">
    <div class="lobby-card" style="text-align: center;">
      <header class="lobby-header">
        <h1 id="gameOverTitle" style="color: var(--accent);">Game Over</h1>
        <p id="gameOverBody" style="font-size: 16px; margin-bottom: 24px;">
          <!-- Populated by JS -->
        </p>
      </header>

      <div class="lobby-intro" style="background: var(--bg-dark); padding: 20px; border-radius: var(--radius-md); margin-bottom: 32px; text-align: left;">
        <strong style="color: var(--text-muted); display: block; margin-bottom: 8px; font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em;">Network Analysis</strong>
        <div id="gameOverStats" style="font-family: var(--font-mono); font-size: 13px; color: var(--text-main);">
          <!-- Populated by JS -->
        </div>
      </div>

      <div class="form-actions">
        <button type="button" id="btnRestart" class="btn btn-xl btn-primary">Initialize New Run</button>
      </div>
    </div>
  </section>

  <!-- GAME DASHBOARD -->
  <main id="viewGame" class="view-game hidden">

    <!-- HEADER / HUD -->
    <header class="game-hud">
      <div class="hud-left">
        <div class="hud-brand">Long Friendship</div>
        <button id="btnTheme" class="btn-icon" title="Toggle Theme">☀</button>
      </div>
      <div id="statsBar" class="hud-stats">
        <!-- Populated by JS -->
      </div>
    </header>

    <!-- MAIN CONTENT SPLIT -->
    <div class="game-workspace">

      <!-- LEFT: VISUALIZATION & DATA -->
      <section class="viz-column">
        <div class="viz-container">
          <canvas id="networkCanvas"></canvas>
          <div class="viz-overlay">
            <div id="vizStatus" class="viz-status">Network Stable</div>
            <div id="progressContainer" class="progress-container hidden">
                <div class="progress-label">Purge Progress <span id="progressText">0/13</span></div>
                <div class="progress-track"><div id="progressBar" class="progress-fill" style="width: 0%"></div></div>
            </div>
          </div>
          <div id="nodeTooltip" class="node-tooltip hidden"></div>
        </div>
        <div class="census-panel">
          <table id="censusTable" class="census-table">
            <thead>
              <tr>
                <th class="col-id">ID</th>
                <th class="col-caste">Caste</th>
                <th class="col-job">Job</th>
                <th class="col-score">Score</th>
                <th class="col-friends">Friends</th>
              </tr>
            </thead>
            <tbody id="censusBody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- RIGHT: NARRATIVE -->
      <aside class="narrative-panel">
        <div class="log-container">
          <div id="log" class="log-feed"></div>
        </div>
        <div class="controls-container">
          <div id="choices" class="choice-grid"></div>
          <div id="notice" class="control-notice"></div>
        </div>
      </aside>

    </div>
  </main>

  <script type="module" src="src/app.js"></script>
</body>
</html>
